# Java

## 環境

- Java 11
- Gradle 6系

```bash
gradle -version

------------------------------------------------------------
Gradle 6.2.2
------------------------------------------------------------

Build time:   2020-03-04 08:49:31 UTC
Revision:     7d0bf6dcb46c143bcc3b7a0fa40a8e5ca28e5856

Kotlin:       1.3.61
Groovy:       2.5.8
Ant:          Apache Ant(TM) version 1.10.7 compiled on September 1 2019
JVM:          11.0.8 (AdoptOpenJDK 11.0.8+10)
OS:           Mac OS X 10.15.4 x86_64
```

## Gradleプロジェクトを作成してみよう

```sh
mkdir demo
cd demo
gradle init
```

### 作成するプロジェクトのタイプを選択

```
Select type of project to generate:
  1: basic
  2: application
  3: library
  4: Gradle plugin
Enter selection (default: basic) [1..4]
```

### 使用する言語を選択

```
Select implementation language:
  1: C++
  2: Groovy
  3: Java
  4: Kotlin
  5: Swift
Enter selection (default: Java) [1..5]
```

### `build.gradle`で使用する言語の選択

```
Select build script DSL:
  1: Groovy
  2: Kotlin
Enter selection (default: Groovy) [1..2]
```

### 使用するテストフレームワーク

```
Select test framework:
  1: JUnit 4
  2: TestNG
  3: Spock
  4: JUnit Jupiter
Enter selection (default: JUnit 4) [1..4]
```

### プロジェクト名

```
Project name (default: demo):
```

### sourceパッケージの名前

```
Source package (default: demo):
```

## Gradleプロジェクトのディレクトリ構造

```
.
├── build.gradle
├── gradle
│   └── wrapper
│       ├── gradle-wrapper.jar
│       └── gradle-wrapper.properties
├── gradlew
├── gradlew.bat
├── settings.gradle
└── src
    ├── main
    │   ├── java
    │   │   └── demo
    │   │       └── App.java
    │   └── resources
    └── test
        ├── java
        │   └── demo
        │       └── AppTest.java
        └── resources
```

### `src/main/java/demo/App.java`の中身

```java
/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package demo;

public class App {
    public String getGreeting() {
        return "Hello world.";
    }

    public static void main(String[] args) {
        System.out.println(new App().getGreeting());
    }
}
```

### `src/test/java/demo/AppTest.java`の中身

```java
/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package demo;

import org.junit.Test;
import static org.junit.Assert.*;

public class AppTest {
    @Test public void testAppHasAGreeting() {
        App classUnderTest = new App();
        assertNotNull("app should have a greeting", classUnderTest.getGreeting());
    }
}
```

## タスクを確認してみよう

```sh
gradle tasks
```

以下のような出力がされる．

```

> Task :tasks

------------------------------------------------------------
Tasks runnable from root project
------------------------------------------------------------

Application tasks
-----------------
run - Runs this project as a JVM application

Build tasks
-----------
assemble - Assembles the outputs of this project.
build - Assembles and tests this project.
buildDependents - Assembles and tests this project and all projects that depend on it.
buildNeeded - Assembles and tests this project and all projects it depends on.
classes - Assembles main classes.
clean - Deletes the build directory.
jar - Assembles a jar archive containing the main classes.
testClasses - Assembles test classes.

Build Setup tasks
-----------------
init - Initializes a new Gradle build.
wrapper - Generates Gradle wrapper files.

Distribution tasks
------------------
assembleDist - Assembles the main distributions
distTar - Bundles the project as a distribution.
distZip - Bundles the project as a distribution.
installDist - Installs the project as a distribution as-is.

Documentation tasks
-------------------
javadoc - Generates Javadoc API documentation for the main source code.

Help tasks
----------
buildEnvironment - Displays all buildscript dependencies declared in root project 'demo'.
components - Displays the components produced by root project 'demo'. [incubating]
dependencies - Displays all dependencies declared in root project 'demo'.
dependencyInsight - Displays the insight into a specific dependency in root project 'demo'.
dependentComponents - Displays the dependent components of components in root project 'demo'. [incubating]
help - Displays a help message.
model - Displays the configuration model of root project 'demo'. [incubating]
outgoingVariants - Displays the outgoing variants of root project 'demo'.
projects - Displays the sub-projects of root project 'demo'.
properties - Displays the properties of root project 'demo'.
tasks - Displays the tasks runnable from root project 'demo'.

Verification tasks
------------------
check - Runs all checks.
test - Runs the unit tests.

Rules
-----
Pattern: clean<TaskName>: Cleans the output files of a task.
Pattern: build<ConfigurationName>: Assembles the artifacts of a configuration.
Pattern: upload<ConfigurationName>: Assembles and uploads the artifacts belonging to a configuration.

To see all tasks and more detail, run gradle tasks --all

To see more detail about a task, run gradle help --task <task>

BUILD SUCCESSFUL in 480ms
1 actionable task: 1 executed
```

## アプリケーションの実行

アプリケーションの実行は`run`タスクで行われる．

```sh
gradle run
```

`Hello, world.`が出力されれば成功．

```
> Task :run
Hello world.

BUILD SUCCESSFUL in 1s
2 actionable tasks: 2 executed
```

## テストの実行

`test`タスクでJunitによる単体テストが実行できる．

```sh
gradle test
```

またテストの結果はhtmlファイルに出力されている．

`./build/reports/tests/test/index.html`に出力されておりブラウザで確認することができる．

## 演習: コラッツの問題をプログラムで実装してみよう

コラッツの問題の詳細はWikipediaを参照．[コラッツの問題](https://ja.wikipedia.org/wiki/%E3%82%B3%E3%83%A9%E3%83%83%E3%83%84%E3%81%AE%E5%95%8F%E9%A1%8C)

問題の概要は「正の整数$n$に対し以下の操作を繰り返すと有限回の操作のうちに必ず1に到達するだろう」というものである．

<img src="https://latex.codecogs.com/gif.latex?\bg_white&space;\LARGE&space;f(n)=&space;\begin{cases}&space;n/2&space;&&space;n&space;\equiv&space;0&space;\pmod{2}&space;\\&space;3n&plus;1&space;&&space;n&space;\equiv&space;1&space;\pmod{2}&space;\end{cases}">

この操作を先ほど作成したGradleプロジェクトの`App.java`にメソッドとして記述し`AppTest.java`でテストを記述することで確かめる．

## 参考資料

- Gradle Tutorials and Guides, https://gradle.org/guides/
- コラッツの問題, https://ja.wikipedia.org/wiki/%E3%82%B3%E3%83%A9%E3%83%83%E3%83%84%E3%81%AE%E5%95%8F%E9%A1%8C
